import { REST, Routes, SlashCommandBuilder } from "discord.js";
import "dotenv/config";

// =======================
// ENV
// =======================
const TOKEN = process.env.DISCORD_BOT_TOKEN;
const CLIENT_ID = process.env.CLIENT_ID;     // Bot application ID
const GUILD_ID = process.env.GUILD_ID;       // For instant updates (recommended)

// =======================
// COMMAND DEFINITIONS
// =======================
const commands = [

  new SlashCommandBuilder()
    .setName("clockin")
    .setDescription("Clock in (must be in voice channel)"),

  new SlashCommandBuilder()
    .setName("clockout")
    .setDescription("Clock out"),

  new SlashCommandBuilder()
    .setName("status")
    .setDescription("Check clock-in status")
    .addUserOption(opt =>
      opt
        .setName("user")
        .setDescription("Check another user")
        .setRequired(false)
    ),

  new SlashCommandBuilder()
    .setName("timesheet")
    .setDescription("View timesheet or total hours in a date range")
    .addUserOption(opt =>
      opt
        .setName("user")
        .setDescription("View another user")
        .setRequired(false)
    )
    .addStringOption(opt =>
      opt
        .setName("start")
        .setDescription("Start date (MM/DD/YYYY)")
        .setRequired(false)
    )
    .addStringOption(opt =>
      opt
        .setName("end")
        .setDescription("End date (MM/DD/YYYY)")
        .setRequired(false)
    ),

].map(cmd => cmd.toJSON());

// =======================
// DEPLOY
// =======================
const rest = new REST({ version: "10" }).setToken(TOKEN);

(async () => {
  try {
    console.log("ğŸš€ Deploying slash commands...");

    // ğŸ”¥ GUILD COMMANDS (instant update)
    await rest.put(
      Routes.applicationGuildCommands(CLIENT_ID, GUILD_ID),
      { body: commands }
    );

    console.log("âœ… Slash commands deployed successfully");
  } catch (err) {
    console.error("âŒ Failed to deploy commands:", err);
  }
})();
